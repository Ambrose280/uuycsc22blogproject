{% extends "base.html" %}

{% block title %}Home - My Blog{% endblock %}

{% block content %}
    <h1>Welcome {{ user['username'] if user else 'Guest' }}!</h1>

    <form method="get" class="mb-4">
        <input type="text" name="search" placeholder="Search posts..." value="{{ search }}">
        <select name="category_id">
            <option value="">All Categories</option>
            {% for category in categories %}
                <option value="{{ category.id }}" {% if category.id|string == category_id %}selected{% endif %}>
                    {{ category.name }}
                </option>
            {% endfor %}
        </select>
        <button type="submit">Search</button>
    </form>

    {% for post in posts %}
        <div class="post mb-5">
            {% if post.featured_image %}
                <img src="{{ url_for('static', filename='images/' + post.featured_image) }}" 
                     alt="Featured Image" width="300" height="200">
            {% endif %}
            <h2>{{ post.title }}</h2>
            <p>
                Posted by <strong>{{ post.username }}</strong> 
                on {{ post.timestamp }} 
                | Category: {{ post.category_name or 'Uncategorized' }} 
                | ðŸ’¬ {{ post.comment_count }} comments
            </p>
            <a href="{{ url_for('view_post', post_id=post.id) }}">Read More</a>
        </div>
    {% else %}
        <p>No posts found.</p>
    {% endfor %}
{% endblock %}
